<html>
    <head>
        <title>Dear data Sprint</title>
        <link rel="stylesheet" href="./css/main.css" />
    </head>
    <body>
         <!-- be sure to include jquery -->
         <a href="#" onclick="return ExportJSON();">Export JSON</a></p>
        </div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <!-- D3 -->
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <!-- TopoJSON -->
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <!-- MainJS -->
        <script src="./js/data-formating.js"></script>
        <script src="./js/main.js"></script>
        <script>
            function ExportJSON(){
        //this is your array with data
             var arr=[];
             
             
                // CHANGE DATA HERE
                arr = musicData.reverse();
        //we will stringify
              var data = JSON.stringify(arr);
              var id=5;//5=xlsx, 4=docx, 3 = pdf
                var urlData='http://exporter.azurewebsites.net/api/export/ExportFromJSON/' + id;
        //and export            
                Export(urlData, id, data);
                return false;
             
            }
        //extension of the file
            function findExtension(id) {
                switch (id) {
                    case 5:
                        return "xlsx";
                    case 4:
                        return "docx";
                    case 3:
                        return "pdf";
                    default:
                        return "notKnown" + id;
                }
            }
        //step 1: POST data, obtain unique id for the export document
        //step 2: obtain file from the unique id
            function Export(urlExport,id, data) {
                var ext = findExtension(id);
    
        //step 1 - post data
                $.ajax({
                    type: "POST",
                    url: urlExport,
                    data: JSON.stringify({ 'data': data }),
                    datatype: "JSON",
                    contentType: "application/json; charset=utf-8"
                })
                    .done(function(result) {
        //step 2 - obtain file
                        var urlDownload = 'http://exporter.azurewebsites.net/api/export/GetFile/' + result;
                        urlDownload += "?fileName=andrei&extension="+ext;
                        window.location=urlDownload;
                    })
                    .fail(function(f) {
                        alert("error:" + f.responseText);
                    });
            }
            
        </script>
    </body>
</html>
